<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,target-densitydpi=device-dpi">
<meta name="generator" content="verse">
<meta name="X-UA-Compatible" content="IE=edge">


<title>Documentation - SHIELD</title>


<link rel="icon" href="/favicon.ico">
<link rel="stylesheet" href="/site.css?d51129b9dca47a3183236d6f49a533636168b196">
<link rel="alternate home" type="application/rss+xml" title="SHIELD - RSS feed" href="/feed.xml">

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-50822525-7"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','UA-50822525-7');</script>
</head>
<body>
  <header class="top">
    <img src="/logo.png?6eed3f85a6b3b055aec7dfb67c8cd7129acc1ab7">
    <nav>
      <li><a href="/">Home</a></li>
      <li><a href="/download/">Download</a></li>
      <li><a href="/community/">Community</a></li>
      <li><a href="/docs/latest/ops/">Docs</a></li>
      <!--li><a href="/docs/latest/dev/">Developers</a></li-->
    </nav>
  </header>

  <div class="header">
    <div>
      <h1>SHIELD Documentation</h1>
    </div>
  </div>

  <div class="content">
    <div class="autotoc-nav">
    </div>

    <div data-autotoc-headings="h2" data-autotoc-title="Table of Contents" data-autotoc-nav=".autotoc-nav">
      <h1>SHIELD Operator's Manual</h1>

<p>Hello, and welcome to the <strong>SHIELD Operator's Manual</strong>, an in-depth look at
all things SHIELD.  This guide aims to be an exhaustive guide to the
installation and operation of the SHIELD Data Protection solution.</p>

<p>If you are looking for a more easy-going start-up guide, you may want to
check out the <a href="/docs/8.6.2/ops/getting-started">Getting Started</a> guide.</p>

<p>If you are interested in contributing to SHIELD itself, or wish to write a
plugin to extend the capabilities of your SHIELD installation, head on over
to the <a href="/docs/8.6.2/dev">SHIELD Developer Documentation</a>.</p>

<h2>What is SHIELD?</h2>

<p>SHIELD is a <em>data protection</em> solution.  It is designed to run scheduled
tasks to backup your important data systems to off-site cloud storage
solutions, and facilitate the restoration of backup archives in the event of
outages or data loss.</p>

<p>SHIELD supports lots of different data systems, through its flexible and
modular plugin architecture.  We currently support:</p>

<ul>
<li><strong>PostgreSQL</strong> databases, via the <a href="/docs/8.6.2/ops/plugins/postgres"><code>postgres</code> plugin</a>.</li>
<li><strong>MySQL</strong> / <strong>MariaDB</strong>, via the <a href="/docs/8.6.2/ops/plugins/mysql"><code>mysql</code> plugin</a>, or the
<a href="/docs/8.6.2/ops/plugins/xtrabackup"><code>xtrabackup</code> plugin</a>.</li>
<li><strong>Redis</strong> key-value store, via the <a href="/docs/8.6.2/ops/plugins/redis"><code>redis</code> plugin</a>.</li>
<li>... and <a href="/docs/8.6.2/ops/plugins#target-plugins">many more</a>.</li>
</ul>

<p>Cloud Storage systems are likewise pluggable.  Out of the box, SHIELD
supports:</p>

<ul>
<li><strong>Amazon S3</strong> (and S3 work-alikes) via the <a href="/docs/8.6.2/ops/plugins/s3"><code>s3</code> plugin</a>.</li>
<li><strong>Microsoft Azure Blobstore</strong> via the <a href="/docs/8.6.2/ops/plugins/azure"><code>azure</code> plugin</a>.</li>
<li><strong>GCP Blobstore</strong> via the <a href="/docs/8.6.2/ops/plugins/google"><code>google</code> plugin</a>.</li>
<li>On-premise <strong>WebDAV</strong> endpoints, via the <a href="/docs/8.6.2/ops/plugins/webdav"><code>webdav</code> plugin</a>.</li>
<li>... and <a href="/docs/8.6.2/ops/plugins/#store-plugins">several others</a>.</li>
</ul>

<p>SHIELD is a distributed system.  The SHIELD <em>core</em> leverages a network of
<em>agents</em> to do the heavy lifting of data backup and restore.  When you
deploy SHIELD into your infrastructure, yet get to choose how many agents
you want to provision, and where in the network they sit.</p>

<p><em>Multi-tenancy</em> is baked right into SHIELD via a robust role-based access
control (RBAC) system in place to help isolate different subsets of users
from one another.  People in one tenant are unable to see configurations
made by people in another tenant.  This allows a single SHIELD to support
multiple, independent teams.</p>

<p>SHIELD also supports a sophisticated authentication system.  You can hook
up to your external Cloud Foundry UAA server, a BOSH UAA instance, or even
Github (both public and on-premise).  As users log in via their external
credentials, SHIELD will automatically create the necessary tenants and
assign roles based on the SHIELD configuration.</p>

<p>We believe strongly in encryption.  Whenever SHIELD communicates across the
network, it does so over encrypted channels (SSH, TLS/HTTPS), with endpoint
identity verification (host keys, mutual TLS, etc.).  All backup archives
are encrypted with unique key material, to ensure that data at-rest is also
resistent to snooping and tampering.</p>

<h2>Installation</h2>

<p>Before you can begin to use SHIELD to protect your important data, you're
going to need to install it.  You have two options: via <a href="https://bosh.io">BOSH</a>
(ideal for Cloud Foundry users), or via <a href="https://docker.com">Docker</a>.</p>

<h3>Planning Your Installation</h3>

<p>Before you start installing the software, it's worthwhile to take a step
back and plan out your installation</p>

<h4>Network Topology</h4>

<p>SHIELD operates best on flat network topologies, without <abbr>NAT</abbr>
devices or HTTP(S) proxy services.</p>

<p>SHIELD requires <em>mutual network visibility</em> between the core and all
cooperating agents.  Each agent issues a small HTTP request to the core,
to inform the core that it is alive, and ready to be inventoried.  This is
called the <em>registration ping</em>.  For each registration ping received, the
core records the name and port given and the remote address of the
connecting TCP socket.  At some later time, the SHIELD core will initiate an
SSH connection to the recorded agent IP address, and gather agent
information.</p>

<p>Because of this, NAT devices tend to confound SHIELD.  The registration ping
originates (at the TCP level) from the NAT gateway, not the host running the
SHIELD agent software.  When the core attempts to connect back to the agent,
it initiates a connection to the <em>NAT device</em> on the agent port, which
generally fails.</p>

<p>Flat networks with HTTP(S) proxies are not impossible, but they can be
unruly.  When configuring proxy clients (via <code>http_proxy</code> / <code>https_proxy</code>,
<code>no_proxy</code> environment variables, or similar mechanisms), you will want to
be especially cognizant of the HTTP(S) connections needed by the SHIELD
software itself.  Often, these connections will need to bypass am
Internet-bound proxy (i.e. one in a DMZ) in order to function.</p>

<p>Likewise, if your cloud storage solution is to be dealt with over HTTP(S),
you will need to make sure that either your proxy server can contact it on
behalf of each SHIELD agent, or that each agent blacklists the domains
and/or IP addresses of the storage endpoints in something like <code>no_proxy</code>.</p>

<h4>Where to Colocate SHIELD Agents</h4>

<p>Depending on the data systems you wish to backup, and their configuration
with respect to access control, you may be able to get away without
colocating <em>any</em> SHIELD agents in your infrastructure.</p>

<p>There are really only two reasons for colocating a SHIELD agent on a data
system installation: plugin requirements and host access control
configuration.</p>

<p>Most SHIELD plugins stream their data through, without relying on any
temporary local storage.  This removes a throughput bottleneck (the disk),
as well as a capacity concern (how much temporary space do you need?).  Some
plugins, however, require local disk.  If the target system doesn't require
local access (more on that in a moment), you may want to spin up some
machines with large ephemeral disks just to handle these backup / restore
operations.  The conversation for backing up data then looks like this:</p>

<p><img src="/docs/8.6.2/ops/manual/dedicated-shield-agent.png" alt="A Dedicated SHIELD Agent" /></p>

<p>Some plugins absolutely cannot be executed across the network.  The
<a href="/docs/8.6.2/ops/plugins/fs">Filesystem Plugin</a>, for example, can only deal with files on the local
filesystem (networked filesystems notwithstanding).  Therefore, if you need
to back up files on a host, you will need to deploy a SHIELD agent to run on
that host.</p>

<h3>Using BOSH</h3>

<p><a href="https://bosh.io">BOSH</a> is a cloud-agnostic deployment and orchestration tool that
excels at lifecycle management of software at all scales.  SHIELD has a
<em>BOSH release</em> that can be used to deploy both the SHIELD core, and SHIELD
agents into new and existing BOSH deployments.</p>

<p>If you're already using BOSH (for example, if you are deploying Cloud
Foundry), adding SHIELD into your infrastructure should be easy.  If you are
still looking for a great release engineering framework, you can get your
feet wet with a SHIELD deployment or three.</p>

<p>The SHIELD BOSH release can be found <a href="https://github.com/shieldproject/shield-boshrelease/releases">on Github</a>.</p>

<h4>Deploying the SHIELD Core</h4>

<p>Usually, the SHIELD core is a standalone, self-contained deployment.  To
deploy, you'll need to find or create a deployment manifest.  A good
starting point can be found <a href="/docs/8.6.2/ops/manual/shield.yml">here</a>.</p>

<p>Save that file locally, as <code>shield.yml</code>, and then run:</p>

<pre><code>$ bosh -e my-bosh deploy \
    -d shield \
    -v static_ip=<span class="highlight">192.0.2.5</span> \
    -v domain=<span class="highlight">shield.example.com</span> \
    shield.yml
</code></pre>

<p>Replace <code>domain</code> with the FQDN of your SHIELD management console, and
<code>192.0.2.5</code> with a static IP that you want to deploy SHIELD on.  You may
need to consult your BOSH <a href="https://bosh.io/docs/cloud-config">cloud-config</a> to find a suitable IP in
the <code>default</code> network.  Optionally, you may modify the deployment manifest
to specify a different network.</p>

<p><strong>NOTE</strong>: The provided deployment manifest assumes that your BOSH director
has been deployed with a <em>config-server</em> that can generate the necessary
certificates and keys for securing SHIELD's communications.  If that is not
the case, you will need to provide additional command-line options to the
<code>bosh deploy</code> command to store the generated credentials locally.  See
<a href="https://bosh.io/docs/cli-int/#vars-store">the BOSH documentation</a> for more information.</p>

<p>Once BOSH has finished deploying SHIELD, you should be able to access the
SHIELD management console at <a href="#">https://$IP</a>.  The default login will be
<code>admin</code> (username) and <code>password</code> (password).</p>

<h4>Deploying SHIELD Agents</h4>

<p>If you need to colocate agents on other BOSH deployments, you have a few
options.  The fastest method is to modify those deployment manifests to
include the <code>shield-agent</code> job in the appropriate BOSH instance groups, like
this:</p>

<pre><code>instance_groups:
  - name: some-database
    jobs:
      # ... other jobs ....
      <span class="highlight">- name:    shield-agent
        release: shield</span>

    # ... rest of configuration ...
</code></pre>

<p>This can get out of hand fast.  A more elegant solution is to use <a href="https://bosh.io/docs/runtime-config">BOSH
runtime configs</a> and <em>inject</em> the SHIELD agent job into other
deployments without mucking about with their deployment manifests.</p>

<p>Here's a working runtime config:</p>

<pre><code>---
releases:
  - name:    shield
    version: 8.4.0

addons:
  - name: shield
    jobs:
      <span class="highlight">- name:    shield-agent
        release: shield</span>
</code></pre>

<p>To use this, update your existing runtime-config:</p>

<pre><code>$ bosh update-runtime-config addons.yml
</code></pre>

<p>Then, <code>bosh deploy</code> your pre-existing manifests, without changing them.
For more information, including how to limit the <code>shield</code> addon to just
specific deployments / VMs, read the
<a href="https://bosh.io/docs/runtime-config">BOSH runtime-configs documentation</a>.</p>

<h3>Using Docker</h3>

<h4>The SHIELD Image</h4>

<p>The SHIELD project builds Docker images for all releases, and
hosts them on <a href="https://cloud.docker.com/u/shieldproject/repository/list">Docker Hub</a>.</p>

<p>To cut down on space used in image registries, and on
containerization hosts, we bundle both components of a typical
SHIELD deployment &mdash; the core and the agent &mdash; into a
single Docker image: <code>shieldproject/shield</code>.  If you want a SHIELD
core, run the container with the <code>/shield/init/core</code> command.  For
agents, run <code>/shield/init.agent</code>.</p>

<h4>Configuring the SHIELD Core</h4>

<p>A (containerized) SHIELD Core relies on two directories that you
probably want to bind-mount in from a persistent backing store:</p>

<ul>
<li><p><code>/var/shield</code> stores the SHIELD database, which houses all of
the live configuration and metadata, including pointers to all
backup archives.  It's kind of a big deal.</p></li>
<li><p><code>/etc/shield</code> stores the SHIELD static configuration.</p></li>
</ul>

<p>The latter directory is trickier to get right, since it contains
some specific files that you may want to specify:</p>

<ol>
<li><p><code>/etc/shield/shieldd.conf</code> - A full SHIELD core YAML
 configuration file.  If not present, one will be created for
 you during container boot, pursuant to a set of environment
 variables (detailed next).</p></li>
<li><p><code>/etc/shield/ssh.key</code> - A private key to be used for core
 &lrarr; communication (initiated by the core).  If you don't
 specify a <code>shieldd.conf</code> file, the image will create one for
 you, and pull the SSH key from this file.  <em>Otherwise, this
 file is <strong>ignored</strong>.</em></p></li>
</ol>

<p>If you don't want to provide files, you <em>can</em> configure your new
SHIELD core via environment variables.  See <em>SHIELD Core
Configuration Reference</em>, below.</p>

<h4>Embedding the SHIELD Agent</h4>

<p>TBD</p>

<h3>Configuration Reference</h3>

<p>This section contains detailed descriptions of all configuration options for
the SHIELD core, and SHIELD agents.</p>

<h4>SHIELD Core Configuration Reference</h4>

<p>The SHIELD core configuration file is a YAML file, read at startup by the
<code>shieldd</code> binary.</p>

<p>Here's an example configuration file:</p>

<pre><code>---
# comments start with the octothorpe (#) and continue
# until the end of the line

api:
  env: Production
  color: green
  bind: 127.0.0.1:80
  session:
    timeout: 300         # (hours) - about 2 weeks
  failsafe:
    username: admin
    password: super-sekrit-password

scheduler:
  threads: 20

limit:
  retention:
    min: 4
    max: 90
</code></pre>

<p>Here's the full set of configuration directives (in dot-notation)
that are currently supported:</p>

<ul>
<li><p><strong>api.bind</strong> - The IP address and TCP port that the SHIELD core daemon
should bind to and listen on for incoming API (HTTP) requests.  Defaults
to <code>*:8888</code>.  <code>*</code> is interpreted to mean <em>all interfaces</em>.</p></li>
<li><p><strong>api.color</strong> - You can color code your SHIELD Web User Interfaces!  Set a hex
value here (i.e. <code>##003300</code>) or other CSS-compatible color identifier, and
the web UI will use it to colorize the environment name.</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_COLOR</code> environment variable.</p></li>
<li><p><strong>api.env</strong> - An name for the environment, that SHIELD will pass
through to clients accessing its API and web management console.  This can
be useful for differentiating your staging SHIELD from your production
SHIELD.  By default, no environment is set.</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_ENV_NAME</code> environment variable.</p></li>
<li><p><strong>api.failsafe.username</strong> - When the SHIELD core starts up, it
checks the local users table.  If it is empty (there are no
local users), it creates a <em>failsafe</em> account, using these
parameters.  This is designed to assist in a safe and secure
bootstrap.</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_FAILSAFE_USERNAME</code> environment variable.</p></li>
<li><p><strong>api.failsafe.password</strong> - The cleartext password to assign the
failsafe user, upon creation.  You can change this later,
without needing to reconfigure or re-deploy SHIELD.</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_FAILSAFE_PASSWORD</code> environment variable.</p></li>
<li><p><strong>api.motd</strong> - A (hopefully) short message to display to operators on the
login screen.  You can use this for compliance messages, important
notices, an explanation of which authentication method people should use,
who to contact for help, etc.  By default, there is no MOTD.</p></li>
<li><p><strong>api.session.clear-on-boot</strong> - Whether or not to clear
interactive sessions from the database when the SHIELD core
reboots.  This is set to <code>yes</code> by default, which will log
everyone out when the core process restarts.</p></li>
<li><p><strong>api.session.timeout</strong> - How long (in hours) before idle
authenticated sessions are invalidated.  Defaults to 720 hours
(about a month).</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_SESSION_TIMEOUT</code> environment variable.</p></li>
<li><p><strong>auth</strong> - A list of non-local authentication backends.</p></li>
<li><p><strong>auth[].backend</strong> - What backend to use for this authentication
provider.  The backend determines how authentication is carried
out, what external systems are involved, etc.</p>

<p>The following backends are supported:</p>

<ul>
<li><p><strong>github</strong> - GitHub, either public (github.com) or private
(Github Enterprise).  Tenant membership is mapped based on
GitHub organization / team membership.</p></li>
<li><p><strong>uaa</strong> - Cloud Foundry UAA, to allow Cloud Foundry users to
log into SHIELD without needing another account.  Tenant
membership is mapped based on scim rights.</p></li>
</ul></li>
<li><p><strong>auth[].identifer</strong> - A unique (and unchanging) internal
identifier for this authentication provider.</p></li>
<li><p><strong>auth[].name</strong> - The human-readable name for this
authentication providers, to be displayed in command-line and
web UI login flows.</p></li>
<li><p><strong>auth[].properties</strong> - A set of backend-specific configuration
items.</p></li>
<li><p><strong>cipher</strong> - Which encryption algorithm and chaining mode to use
for encrypting backup archives.  Supported values are:</p>

<ul>
<li><code>aes256-ctr</code> - 256-bit AES, in Counter CBC mode.</li>
</ul>

<p>We plan to introduce more types as the need arises.</p>

<p>Each backup archive tracks which encryption type was in force when it was
taken, to allow operators to change this value without rendering previous
backup archives unusable.</p></li>
<li><p><strong>data-dir</strong> - The absolute path to the directory where SHIELD will
store all of its persistent data.  Important files stored here include:</p>

<ul>
<li><code>$datadir/shield.db</code> - The SHIELD metadata database.</li>
<li><code>$datadir/vault/*</code> - The encrypted files that back the vault.</li>
<li><code>$datadir/vault.crypt</code> - The encrypted file which stores the seal
keys to the SHIELD Vault.  This file is encrypted with the
SHIELD master password.</li>
<li><code>$datadir/bootstrap.log</code> - A log of what occurred during a SHIELD
<em>from-nothing</em> recovery.</li>
</ul>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_DATA</code> environment variable.</p></li>
<li><p><strong>debug</strong> - Whether or not to enable verbose debug logging.  This is a
boolean, and it defaults to <code>no</code>, which is a sane choice for any
production or staging environment.  Debug logging is verbose, and very
low-level.  It is of primary value to SHIELD developers.</p></li>
<li><p><strong>fabrics</strong> - A list of SHIELD Agent Fabric configurations.</p></li>
<li><p><strong>fabrics[].name</strong> - The name of this fabric.  For the Legacy
SSH fabric, this must be <code>legacy</code>.</p></li>
<li><p><strong>fabrics[].ssh-key</strong>  - The literal, PEM-encoded RSA private
key that the SHIELD core should use when connecting to remote
SHIELD agent processes.</p>

<p>This is <strong>required</strong> for the Legacy SSH fabric.</p></li>
<li><p><strong>limit.retention.max</strong> - The maximum number of days that any
backup archive may be retained for.  This can be useful to
ensure that tenants don't overrun storage with excessively long
retention periods.</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_MAXIMUM_RETENTION</code> environment variable.</p></li>
<li><p><strong>limit.retention.min</strong> - The minimum number of days that all
backup archives must be retained for.  This allows SHIELD
operators to enforce organization-wide compliance for archive
retention.  Defaults to 1 (day).</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_MINIMUM_RETENTION</code> environment variable.</p></li>
<li><p><strong>scheduler.fast-loop</strong> - The frequency, in seconds, of the
SHIELD scheduler's "fast loop."  On every iteration of the fast
loop, SHIELD will schedule backup jobs that ought to run, execute
pending tasks (if it has workers available), and handle inbound
agent registration pings.</p>

<p>By default, the fast loop executes once a second.  Unles you have an
urgent need otherwise, you shouldn't change this.</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_FAST_LOOP</code> environment variable.</p></li>
<li><p><strong>scheduler.slow-loop</strong> - The frequency, in seconds, of the
SHIELD scheduler's "slow loop."  The slow loop handles
administrative tasks for the SHIELD core, including archive
expiration and purgation, session clearing, data analytics, and
cloud storage testing></p>

<p>By default, the slow loop exucutes once every 300 seconds (5 minutes).
Turning up the frequency will result in higher load on external cloud
storage systems.  Decreasing the frequency will cause expired archives to
remain in cloud storage for longer.</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_SLOW_LOOP</code> environment variable.</p></li>
<li><p><strong>scheduler.threads</strong> - How many worker threads should the
SHIELD core spin.  This defaults to <code>5</code>, but you should increase
the 1.5 times the number of concurrent backup tasks you expect to
see, at peak.</p>

<p>Low worker counts can cause the SHIELD scheduler to "stall out"
and not execute scheduled tasks in a timely fashion.  The 1.5x
multiplier accounts for purge operations, cloud storage tests, and
other background tests.</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_THREADS</code> environment variable.</p></li>
<li><p><strong>scheduler.timeout</strong> - How long (in hours) should the SHIELD
core allow a single task to execute before considering it
<em>hung</em>, and terminate it.</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$SHIELD_TASK_TIMEOUT</code> environment variable.</p></li>
<li><p><strong>vault.address</strong> - The URL of the SHIELD Vault.  This should almost
always be <code>https://127.0.0.1:8200</code>.  If you are using the BOSH release,
this cannot be configured.</p>

<p>In the Docker image (under automatic configuration), this can be
set by the <code>$VAULT_ADDR</code> environment variable.</p></li>
<li><p><strong>vault.ca</strong> - The path to the X.509 Certificate Authority certificate,
PEM-encoded, for validating the Vault certificate.  If you are using the
BOSH release, this cannot be configured (nor does it need to be).</p></li>
<li><p><strong>web-root</strong> - The root path to the SHIELD web management UI assets.
Defaults to the relative path <code>web</code>, which is probably not what you want.</p></li>
</ul>

<h4>SHIELD Agent Configuration File Reference</h4>

<p>The SHIELD agent configuration file is a YAML file, read at startup by the
<code>shield-agent</code> binary.</p>

<ul>
<li><p><strong>name</strong> (required) - The name of this agent, for registration with the
SHIELD core.  This name will appear in web and CLI interfaces, to people
configuring backup jobs, and should describe the role this agent
installation plays in the overall topology.</p></li>
<li><p><strong>authorized_keys_file</strong> (required) - The path to an SSH <em>authorized
keys</em> file, which should contain the public component of the agent private
key that the SHIELD core will use to authenticate to the agent for remote
orchestration.</p></li>
<li><p><strong>listen_address</strong> - The IP address and TCP port that the SHIELD agent
should bind to and listen on for incoming orchestration (via SSH).
Defaults to <code>*:5444</code>.  <code>*</code> is interpreted to mean <em>all interfaces</em>.</p></li>
<li><p><strong>plugin_paths</strong> (required) - A YAML list of paths that the agent will
use when attempting to resolve plugin names to binaries.  This is kind of
like the canonical UNIX <code>$PATH</code> environment variable, except it does not
apply to any programs that the plugins themselves attempt to execute.</p>

<p>You should list all of your plugin binary directories here.</p></li>
<li><p><strong>registration</strong> - This subsection governs how this agent will register
with its SHIELD core.  While technically optional, registration is highly
recommended, from an ease-of-use standpoint.</p>

<p>The following keys exist underneath <code>registration:</code>:</p>

<ul>
<li><p><strong>url</strong> - The HTTP(S) URL of the upstream SHIELD core.  This will
normally be something like <code>https://$ip_or_hostname/</code>.</p></li>
<li><p><strong>interval</strong> - How often (in seconds) should the agent ping the SHIELD
core and provide reigstration details.  The SHIELD core determines when
it <em>validates</em> agent registrations and extracts metadata information, so
this setting cannot be used to increase the frequency of such updates.</p></li>
<li><p><strong>shield_ca_cert</strong> - Path to a file containing the PEM-encoded CA
certificate that issued the SHIELD core's X.509 TLS certificate.  This
allows operators to validate self-signed certificates, or custom,
in-house CA-issued certificates.</p></li>
</ul>

<p>This has no effect of <code>skip_verify</code> is set to true.</p>

<ul>
<li><strong>skip_verify</strong> - Whether or not to disable verification of the SHIELD
core X.509 TLS certificate.  This defaults to <em>false</em>, since certificate
verification is generally A Good Thing &trade;</li>
</ul></li>
</ul>

<h2>Using SHIELD</h2>

<p>SHIELD features a beautiful web user interface and a robust command-line
interface.  We like to think of the web UI as providing more visibility into
the configuration of SHIELD, while the CLI provides more flexibility in
terms of automation.</p>

<h3>The Web UI</h3>

<p>You can access the web UI by pointing your browser at the IP address of your
SHIELD core installation.  SHIELD forces all HTTP traffic over TLS, via port
443, for security reasons.</p>

<h4>Logging In</h4>

<p>Before you can interact with SHIELD, you must log in.</p>

<p><img src="/docs/8.6.2/ops/manual/ui/login-screen.png" alt="The SHIELD Web UI Login Screen" /></p>

<p>On the right is the login form for local authentication.  On the left is a
list of the configured <em>authentication providers</em>.  These allow SHIELD
administrators to integrate SHIELD authentication with 3rd-party, external
identity systems like Github, or Cloud Foundry UAA.</p>

<p>Note: You may not have any authentication providers listed.</p>

<h4>The Heads-up Display</h4>

<p>All logged in?  Great!</p>

<p>At the top of the screen, you should see the <em>heads-up display</em>:</p>

<p><img src="/docs/8.6.2/ops/manual/ui/hud.png" alt="The SHIELD Heads-Up Display" /></p>

<p>To the left is identifying information about this SHIELD core, including the
configured SHIELD environment name, the IP address and/or fully-qualified
domain, and the version of SHIELD.</p>

<p>The first pane summarizes the overall health of SHIELD and the current
tenant's configuration.</p>

<ul>
<li><p><strong>SHIELD is ...</strong> - Reports the current status of the SHIELD API.
If all is well, this will say <em>SHIELD is up</em>, in a reassuring green hue.
If the SHIELD core is not responding to API calls, this will say <em>SHIELD
is DOWN</em>, in red.  Sometimes, it may report that the SHIELD is locked,
in which case an administrator needs to intervene to unlock it.</p></li>
<li><p><strong>Cloud Storage is ...</strong> - Reports the health of all global cloud
storage systems, as well as the health of all cloud storage specific to
the currently selected tenant.</p></li>
<li><p><strong>Jobs are ...</strong> - Reports the status of all backup jobs for the current
tenant.  It considers only the most recent execution of each job,
whether it was scheduled or run manually (ad hoc).</p></li>
</ul>

<p>The second pane, titled <em>Data Protection Summary</em>, provides some numbers for your
consideration.  All of these are per-tenant.</p>

<ul>
<li><p><strong>Scheduled Backup Jobs</strong> - How many total jobs are scheduled to run.</p></li>
<li><p><strong>Backup Archives</strong> - How many backup archives exist.</p></li>
<li><p><strong>Cloud Storage Used</strong> - How much of cloud storage is being used by the
backup archives for this tenant's jobs.</p></li>
<li><p><strong>Daily Storage Increase</strong> - A simple linear projection of the amount of
additional cloud storage that will be used, each day, given the current
schedules, retention policies, and archive sizes.</p></li>
</ul>

<p>The heads-up display is partially dependent on the current tenant, so if you
switch to a different tenant, you might get different numbers / statuses.</p>

<h4>The Task Sidebar</h4>

<p>To the left of the screen is a sidebar with links to the common tasks you
may want to perform:</p>

<ul>
<li>Run an ad hoc backup</li>
<li>Restore data from a backup</li>
<li>Configure a new backup job</li>
</ul>

<h4>The Top Bar</h4>

<p>TBD</p>

<h4>The Navigation Bar</h4>

<p>The black navigation bar (immediately under the heads-up display) will stick
to the top of the viewport as you scroll.  It provides top-level navigation,
including:</p>

<ul>
<li><p><strong>Systems</strong> - Your data systems are the things that SHIELD protects, by
making copies of the important data contained within them, on a scheduled
and recurring basis.  This page lets you review and manage those systems.</p></li>
<li><p><strong>Storage</strong> - Cloud storage is where SHIELD keeps the backup copies of
your data.  You can configure however many storage systems you want, in
whatever configuration you deem appropriate.  This page lets you access
both global (shared) cloud storage systems, and those specific to your
tenant.</p></li>
<li><p><strong>Admin</strong> - This one is for SHIELD administrators only.  It provides
access to a host of administrative functions like tenant and user
management, global cloud storage management, etc.</p></li>
</ul>

<h3>The CLI</h3>

<p>If you prefer life in the terminal, you're in luck &mdash; SHIELD
has a command-line interface packed with just as much
functionality as the web interface.  To get started with the CLI,
you first must configure access to the SHIELD core by identifying
the API endpoint and logging in:</p>

<pre><code>$ shield api https://<span class="highlight">shield-ip</span> my-shield

$ shield -c my-shield login
Username: admin
Password:
logged in successfully!
</code></pre>

<p>To see what more the CLI can do, check out the following helpful
commands:</p>

<pre><code>$ shield -h
$ shield commands
</code></pre>

<p>Note: the remainder of this guide will focus on the web user
interface.  Terminal fans are encouraged to explore the SHIELD CLI
to see how those same concepts can be applied in a textual world.</p>

<h2>Configuring Backups</h2>

<p>TBD</p>

<h3>Wizard Walkthrough</h3>

<p>TBD</p>

<h3>The Systems Page</h3>

<p>TBD</p>

<h3>Adding a second schedule</h3>

<p>TBD</p>

<h2>Running Backups / Restores</h2>

<p>The primary point of running SHIELD is to run regularly-scheduled
backup jobs, and then (when necessary) restore backups to their
original data system.</p>

<h3>Ad hoc vs. Scheduled</h3>

<p>SHIELD can run backup jobs in one of two ways.</p>

<p><strong>Ad hoc</strong> backup jobs are executed in one-off scenarios, at the
direction of a SHIELD operator.</p>

<p><strong>Scheduled</strong> backup jobs are run at specific, cyclical times.
Operators can specify that backups should be taken hourly, daily,
weekly, or monthly.  Inside SHIELD, the <em>scheduler</em> keeps track of
the next scheduled run of each job, and executes accordingly.</p>

<p>For maximum value, you will probably want to schedule most of your
backups.  The two modes of operation are not mutually exclusive;
you can trigger an ad hoc run of a scheduled job.  This comes in
handy when carrying out maintenance or change operations against a
system and you want the freshest <em>pre-change</em> backup archives as
you can get.</p>

<h3>The Ad hoc backup Wizard</h3>

<p>TBD</p>

<h3>The Timeline View</h3>

<p>TBD</p>

<h3>Annotating Tasks</h3>

<p>TBD</p>

<h3>Restoring from the Timeline Page</h3>

<p>TBD</p>

<h3>The Restore Wizard</h3>

<p>TBD</p>

<h2>Cloud Storage</h2>

<p>TBD</p>

<h3>How SHIELD Uses Cloud Storage</h3>

<p>TBD</p>

<h3>Retention Policies</h3>

<p>TBD</p>

<h3>How the HUD interacts</h3>

<p>TBD</p>

<h3>Storage Thresholds</h3>

<p>TBD</p>

<h3>The Storage Display Page</h3>

<p>TBD</p>

<h3>Shared Storage</h3>

<p>TBD</p>

<h2>Multi-Tenancy</h2>

<p>TBD</p>

<h3>What is a Tenant?</h3>

<p>TBD</p>

<h3>Switching Tenants</h3>

<p>TBD</p>

<h3>Role Assignments (and what they mean)</h3>

<p>TBD</p>

<h3>Authentication Providers and Tenants</h3>

<p>TBD</p>

<h4>UAA</h4>

<p>TBD</p>

<h4>Github</h4>

<p>TBD</p>

<h3>The default tenant</h3>

<p>TBD</p>

<h2>Encryption</h2>

<p>TBD</p>

<h3>What is Encryption</h3>

<p>TBD</p>

<h3>Why do I Care?</h3>

<p>TBD</p>

<h3>How does SHIELD use encryption?</h3>

<p>TBD</p>

<h3>At-rest vs. in-flight encryption</h3>

<p>TBD</p>

<h2>Administration</h2>

<p>All Administrative tasks are done from the admin panel </p>

<p><img src="admin-panel.png" alt="The Shield Admin Panel" /></p>

<h3>Initializing A SHIELD Core</h3>

<p>TBD</p>

<h3>The Master Password</h3>

<p>TBD</p>

<h3>The Administrative Backend</h3>

<p>TBD</p>

<h4>Tenants</h4>

<p>Under <code>Tenants</code> admins have the ability to see all current teneants as well as create new tenants.
Users can be invited to tenants by editing the tenant or during tenant creation. </p>

<p><img src="tenant-panel.png" alt="Tenants" /></p>

<h4>Shared Storage</h4>

<p>Shared storage can be found under <code>Global Storage Systems</code>, from this page you can view all existing
global stores as well as create new ones. Shared or global storage can be configured for use across
multiple tenants.</p>

<p><img src="storage-panel.png" alt="Global Storage" /></p>

<h4>Retention Policy Templates</h4>

<p>TBD</p>

<h4>Managing Agents</h4>

<p>Information on Shield Agents can be found under <code>Agents of Shield</code>. This can be helpful for keeping
inventory on agents throughout your deployments or to resync any disconnected agents. </p>

<p><img src="agents-panel.png" alt="Shield Agents" /></p>

<h4>Authentication Providers</h4>

<p>You can view the configuration of your shield authentication providers under <code>Authemtication Providers</code>.
Please note that configuring an additonal auth provider is done from deploying shield itself.</p>

<p><img src="auth-panel.png" alt="Authentication" /></p>

<h4>Local User Management</h4>

<p>Shield users can be managed under <code>Local User Management</code>. Here admins can view a list of all Shield users,
edit permissions of users, and onboard new users.</p>

<p><img src="user-panel.png" alt="Users" /></p>

<h4>Rekeying SHIELD</h4>

<p>If you wish to Change your shield master password, you can find this option under <code>Rekeying SHIELD</code></p>

<p><strong>Note</strong> You need your current master password to complete this.</p>

<p><img src="rekey-panel.png" alt="Panel" /></p>

<h4>Session Management</h4>

<p>Admins can manage user sessions under <code>Manage User Sessions</code>. Here You can get information on all current sessons
and expire session tokens if desired.</p>

<p><img src="session-panel.png" alt="Sessions" /></p>

<h2>How Do I Backup <em>X</em>?</h2>

<h3>SHIELD Itself</h3>

<p>In a disaster recovery situation, it's important to get shield up and running to begin recovering your other data systems
as soon as possible. It requires backups of SHIELD itself.</p>

<h4>How do SHIELD backups work?</h4>

<p>The SHIELD state exists as 3 entities found in /var/vcap/store/shield (for a shield deployed by bosh).
They Include:
  - The SHIELD database which exists as a sqlite database name shield.db
  - The vault.crpyt file
  - The vault directory</p>

<p>We use the file system plugin to backup these 3 items and store them as our SHIELD backup. When using the fs plugin to backup
shield make sure <code>Strict Mode</code> is unchecked. We do this to prevent failures with missing files which can happen with the presence
or absence of the <code>shield.db-journal</code>.</p>

<h4>The Problem With Encryption</h4>

<p>SHIELD backups <em>must</em> be taken with fixed key encryption. In this situation of restoring shield, we cannot use generated
encryption keys because there is no way to restore our vault with keys that exist in that sealed vault. This is why it's
important to keep the fixed key generated when you initialize SHIELD in a safe and retrievable place.  </p>

<h4>Configuring the <code>fs</code> Plugin</h4>

<p>Lets walk through creating a SHIELD backup from the shield webui.</p>

<h4>For the properties make sure you're targeting the agent on the SHIELD box and the correct path.</h4>

<p><img src="shield-recover2.png" alt="Recover" /></p>

<h4>Make sure to de-select <code>Randomize Encryption Keys</code></h4>

<p><img src="shield-recover4.png" alt="Recover" /></p>

<h4>Lets double check our configuration is correct</h4>

<p><img src="shield-recover5.png" alt="Recover" /></p>

<h4>"Normal-mode" Restores</h4>

<p>TBD</p>

<h3>Cloud Foundry UAA</h3>

<h3>Cloud Foundry CCDB</h3>

<h3>BOSH</h3>

<h2>Monitoring SHIELD</h2>

<p>TBD</p>

<h3>Using the HUD</h3>

<p>TBD</p>

<h3>API Access for Monitoring</h3>

<p>TBD</p>

<h3>Metrics of interest</h3>

<p>TBD</p>

<h3>Log messages to watch</h3>

<p>TBD</p>

<h2>Glossary</h2>

<p>Shield has a number of terms and abstractions that are important for an operator to know when working with the tool.</p>

<ul>
<li><p><strong>Shield Core</strong>: The shield core servers as the main deployed shield box that includes the shield daemon and api.</p></li>
<li><p><strong>Shield Agents</strong>: A shield agent is software that is co-loacted on a deployment you wish to back up that leverages plugins to back up given data system</p></li>
<li><p><strong>Tenants</strong>: Shield provides tenancy to allow the seperation of teams/environments by allowing tenants to be created. Under a tenant users can be assigned 
           and given roles, stores can be created, and indivdual systems can be backed up.</p></li>
<li><p><strong>Targets</strong>: A target is the name of a configured data system. They can be under the data systems tab.</p></li>
</ul>


    </div>
  </div>

  <footer>
    <div class="g">
      <div class="x3">
        <img src="/swlogo.png?0b567bdcee59ac95e3eaf667ec543ebc1631d6c0">

        <p>SHIELD is maintained by shieldproject,
        a leading Cloud-Native consulting firm.</p>
      </div>

      <div class="x3">
        <nav>
          <li><a href="/">Home</a></li>
          <li><a href="/download/">Download</a></li>
          <li><a href="/community/">Community</a></li>
          <li><a href="/docs/latest/ops/">Docs</a></li>
          <!--li><a href="/docs/latest/dev/">Developers</a></li-->
        </nav>
      </div>

      <div class="x3">
      </div>
    </div>

    <div class="copyright">
      <p>Copyright &copy; 2019 The SHIELD Authors.  All rights reserved.</p>
    </div>
  </footer>
  <script type="text/javascript" src="/site.js?d2112e355882784cf7f38561cf3ccb0bd5da3111"></script>
</body>
</html>
